<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ—¥æœ¬ã®å³¶ã‚¬ãƒãƒ£ã€ãƒ¬ã‚¢ãƒªãƒ†ã‚£æ©Ÿèƒ½ä»˜ãã€‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: "M PLUS Rounded 1c", sans-serif;
      }
      .card-reveal {
        animation: reveal 0.8s cubic-bezier(0.215, 0.61, 0.355, 1);
      }
      @keyframes reveal {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      .gacha-button {
        transition: all 0.3s ease;
      }
      .gacha-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }
      .gacha-button:active {
        transform: translateY(1px);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.4);
      }
      .modal-enter {
        animation: fadeIn 0.3s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* SSRèƒŒæ™¯ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
      @keyframes rainbow-flow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã”ã¨ã®èƒŒæ™¯ã‚¹ã‚¿ã‚¤ãƒ« */
      .rarity-n-bg {
        background-color: #f8fafc; /* slate-50 */
      }
      .rarity-r-bg {
        background: linear-gradient(135deg, #d1fae5, #ffffff); /* green-100 to white */
      }
      .rarity-sr-bg {
        background: linear-gradient(135deg, #fef08a, #fef9c3); /* yellow-200 to yellow-100 */
      }
      .rarity-ssr-bg {
        background: linear-gradient(-45deg, #fbcfe8, #a5b4fc, #81e6d9, #fef08a);
        background-size: 400% 400%;
        animation: rainbow-flow 8s ease infinite;
      }

      .rarity-n-text {
        color: #64748b;
      } /* slate-500 */
      .rarity-r-text {
        color: #059669;
      } /* green-600 */
      .rarity-sr-text {
        color: #b45309;
      } /* amber-700 */
      .rarity-ssr-text {
        color: white;
        font-weight: 900;
        text-shadow: 0 0 8px #ffd700, 2px 2px 4px rgba(0, 0, 0, 0.6);
      }
    </style>
  </head>
  <body class="bg-gradient-to-b from-sky-300 to-blue-500 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md mx-auto text-center">
      <header class="mb-8">
        <h1 class="text-4xl md:text-5xl font-extrabold text-white text-shadow-lg"><span class="text-yellow-300">æ—¥æœ¬ã®å³¶</span>ã‚¬ãƒãƒ£</h1>
        <p class="text-white mt-2 font-medium">ä»Šæ—¥ã®å³¶ã¯ã©ã“ã ï¼Ÿã€ãƒ¬ã‚¢ãƒªãƒ†ã‚£æ©Ÿèƒ½ä»˜ãã€‘</p>
      </header>

      <main id="result-card" class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl p-6 min-h-[300px] flex flex-col justify-center items-center transition-all duration-300 relative">
        <div id="initial-state" class="text-center">
          <div class="text-6xl mb-4 animate-bounce">ğŸï¸</div>
          <p class="text-xl font-bold text-gray-700">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦<br />ã‚¬ãƒãƒ£ã‚’å¼•ã„ã¦ã¿ã‚ˆã†ï¼</p>
        </div>
        <div id="result-state" class="hidden text-center w-full h-full">
          <p id="rarity-display" class="font-bold text-2xl mb-2"></p>
          <div id="new-badge" class="absolute top-2 right-2 bg-pink-500 text-white font-bold text-xs py-1 px-3 rounded-full transform rotate-12 hidden">NEW!</div>
          <h2 id="island-name" class="text-4xl font-bold text-gray-800 mb-1"></h2>
          <p id="island-prefecture" class="text-lg font-semibold text-sky-600 mb-4"></p>
          <p id="island-description" class="text-base text-gray-600 mb-6 h-24 overflow-y-auto custom-scrollbar"></p>
          <a id="map-link" href="#" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600 transition-colors"> åœ°å›³ã§è¦‹ã‚‹ ğŸ—ºï¸ </a>
        </div>
      </main>

      <footer class="mt-8">
        <button id="gacha-button" class="gacha-button bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold text-2xl py-4 px-10 rounded-full shadow-lg">ã‚¬ãƒãƒ£ã‚’å¼•ãï¼</button>
      </footer>

      <section class="mt-10 w-full max-w-md mx-auto">
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
          <h3 class="text-2xl font-bold text-gray-700 mb-4 text-center">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (<span id="collection-count">0</span> / <span id="total-count">0</span>)</h3>
          <div id="collection-grid" class="custom-scrollbar grid grid-cols-3 sm:grid-cols-4 gap-2 text-center max-h-48 overflow-y-auto p-1"></div>
          <button id="reset-collection-button" class="mt-4 w-full bg-red-500 text-white font-bold py-2 px-4 rounded-full hover:bg-red-600 transition-colors text-sm">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </section>
    </div>

    <div id="confirm-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 modal-enter">
      <div class="bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full text-center">
        <h4 class="text-xl font-bold text-gray-800 mb-2">ç¢ºèª</h4>
        <p class="text-gray-600 mb-6">æœ¬å½“ã«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ<br />ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚</p>
        <div class="flex justify-center gap-4">
          <button id="cancel-reset-button" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-full hover:bg-gray-300 transition-colors">ã„ã„ãˆ</button>
          <button id="confirm-reset-button" class="bg-red-500 text-white font-bold py-2 px-6 rounded-full hover:bg-red-600 transition-colors">ã¯ã„ã€ãƒªã‚»ãƒƒãƒˆã—ã¾ã™</button>
        </div>
      </div>
    </div>

    <script>
      // æ—¥æœ¬ã®å³¶ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¬ã‚¢ãƒªãƒ†ã‚£ä»˜ãï¼‰
      const islands = [
        // SSR
        { name: "æ²–ãƒå³¶", prefecture: "ç¦å²¡çœŒ", description: "å³¶å…¨ä½“ãŒå®—åƒå¤§ç¤¾ã®ç¥é ˜ã§ã€ã€Œç¥ã®å³¶ã€ã¨å‘¼ã°ã‚Œã‚‹ã€‚å¥³äººç¦åˆ¶ãªã©å³ã—ã„æŸãŒã‚ã‚Šã€2017å¹´ã«ä¸–ç•Œéºç”£ã«ç™»éŒ²ã€‚", lat: 34.24, lon: 130.1, rarity: "SSR" },
        { name: "é’ãƒ¶å³¶", prefecture: "æ±äº¬éƒ½", description: "äºŒé‡ã‚«ãƒ«ãƒ‡ãƒ©ã¨ã„ã†ä¸–ç•Œçš„ã«ã‚‚çã—ã„åœ°å½¢ã‚’æŒã¤æœ‰äººå³¶ã€‚ã€Œæ—¥æœ¬ã®ç§˜å¢ƒã€ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ã€‚", lat: 32.45, lon: 139.76, rarity: "SSR" },
        { name: "è»è‰¦å³¶ (ç«¯å³¶)", prefecture: "é•·å´çœŒ", description: "ã‹ã¤ã¦ç‚­é‰±ã§æ „ãˆãŸç„¡äººå³¶ã€‚ãã®ç‹¬ç‰¹ã®æ™¯è¦³ã‹ã‚‰ä¸–ç•Œæ–‡åŒ–éºç”£ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚", lat: 32.62, lon: 129.73, rarity: "SSR" },
        { name: "å—é³¥å³¶", prefecture: "æ±äº¬éƒ½", description: "æ—¥æœ¬ã®æœ€æ±ç«¯ã«ä½ç½®ã™ã‚‹å³¶ã€‚ä¸€èˆ¬äººã®ä¸Šé™¸ã¯åŸå‰‡ã¨ã—ã¦è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", lat: 24.28, lon: 153.98, rarity: "SSR" },
        { name: "æ²–ãƒé³¥å³¶", prefecture: "æ±äº¬éƒ½", description: "æ—¥æœ¬ã®æœ€å—ç«¯ã«ä½ç½®ã™ã‚‹å³¶ã€‚æº€æ½®æ™‚ã«ã¯ã»ã¨ã‚“ã©ãŒæµ·é¢ä¸‹ã«æ²ˆã‚€ãŸã‚ã€è­·å²¸å·¥äº‹ã§å®ˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", lat: 20.42, lon: 136.08, rarity: "SSR" },
        // SR
        { name: "å±‹ä¹…å³¶", prefecture: "é¹¿å…å³¶çœŒ", description: "æ¨¹é½¢æ•°åƒå¹´ã®ç¸„æ–‡æ‰ãŒæœ‰åã€‚ä¸–ç•Œè‡ªç„¶éºç”£ã«ã‚‚ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ç¥ç§˜çš„ãªå³¶ã§ã™ã€‚", lat: 30.35, lon: 130.52, rarity: "SR" },
        { name: "å°ç¬ åŸè«¸å³¶ (çˆ¶å³¶)", prefecture: "æ±äº¬éƒ½", description: "ã€Œæ±æ´‹ã®ã‚¬ãƒ©ãƒ‘ã‚´ã‚¹ã€ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ç‹¬è‡ªã®ç”Ÿæ…‹ç³»ã‚’æŒã¤ã€‚ãƒ›ã‚¨ãƒ¼ãƒ«ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°ã‚„ãƒ‰ãƒ«ãƒ•ã‚£ãƒ³ã‚¹ã‚¤ãƒ ãŒäººæ°—ã€‚", lat: 27.09, lon: 142.19, rarity: "SR" },
        { name: "åˆ©å°»å³¶", prefecture: "åŒ—æµ·é“", description: "ã€Œåˆ©å°»å¯Œå£«ã€ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ç¾ã—ã„åˆ©å°»å±±ãŒãã³ãˆã‚‹å³¶ã€‚ã‚¦ãƒ‹ãªã©ã®æµ·ç”£ç‰©ã‚‚çµ¶å“ã§ã™ã€‚", lat: 45.18, lon: 141.21, rarity: "SR" },
        { name: "ä¸é‚£å›½å³¶", prefecture: "æ²–ç¸„çœŒ", description: "æ—¥æœ¬æœ€è¥¿ç«¯ã®å³¶ã€‚æµ·åº•éºè·¡ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã‚„ã€å·¨å¤§ãªã‚¬ã€Œãƒ¨ãƒŠã‚°ãƒ‹ã‚µãƒ³ã€ã§çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", lat: 24.46, lon: 122.98, rarity: "SR" },
        { name: "ä½æ¸¡å³¶", prefecture: "æ–°æ½ŸçœŒ", description: "ã‹ã¤ã¦ã¯é‡‘ã®å³¶ã¨ã—ã¦æ „ãˆã¾ã—ãŸã€‚ãƒˆã‚­ã®é‡ç”Ÿå¾©å¸°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚", lat: 38.03, lon: 138.35, rarity: "SR" },
        { name: "è¥¿è¡¨å³¶", prefecture: "æ²–ç¸„çœŒ", description: "å³¶ã®90%ãŒã‚¸ãƒ£ãƒ³ã‚°ãƒ«ã«è¦†ã‚ã‚ŒãŸã€Œæ±æ´‹ã®ã‚¬ãƒ©ãƒ‘ã‚´ã‚¹ã€ã€‚ç‰¹åˆ¥å¤©ç„¶è¨˜å¿µç‰©ã‚¤ãƒªã‚ªãƒ¢ãƒ†ãƒ¤ãƒãƒã‚³ãŒç”Ÿæ¯ã€‚", lat: 24.33, lon: 123.83, rarity: "SR" },
        { name: "å‹ãƒ¶å³¶", prefecture: "å’Œæ­Œå±±çœŒ", description: "æ—§æ—¥æœ¬è»ã®è¦å¡è·¡ãŒæ®‹ã‚‹ç„¡äººå³¶ç¾¤ã€‚ãƒ¬ãƒ³ã‚¬é€ ã‚Šã®ç ²å°è·¡ãŒã€Œãƒ©ãƒ”ãƒ¥ã‚¿ã®ã‚ˆã†ã ã€ã¨äººæ°—ã§ã™ã€‚", lat: 34.28, lon: 135.0, rarity: "SR" },
        { name: "å¤§ä¹…é‡å³¶", prefecture: "åºƒå³¶çœŒ", description: "ã€Œã†ã•ãã®å³¶ã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã€ãŸãã•ã‚“ã®é‡ç”Ÿã®ã†ã•ãã¨è§¦ã‚Œåˆãˆã¾ã™ã€‚ã‹ã¤ã¦ã¯æ¯’ã‚¬ã‚¹å·¥å ´ãŒã‚ã£ãŸæ­´å²ã‚‚ã€‚", lat: 34.31, lon: 132.99, rarity: "SR" },
        { name: "æ³¢ç…§é–“å³¶", prefecture: "æ²–ç¸„çœŒ", description: "æœ‰äººå³¶ã¨ã—ã¦ã¯æ—¥æœ¬æœ€å—ç«¯ã€‚ã€Œãƒãƒ†ãƒ«ãƒãƒ–ãƒ«ãƒ¼ã€ã¨å‘¼ã°ã‚Œã‚‹ç¾ã—ã„æµ·ã¨ã€å—åå­—æ˜ŸãŒè¦‹ãˆã‚‹ã“ã¨ã§æœ‰åã€‚", lat: 24.05, lon: 123.77, rarity: "SR" },
        // R
        { name: "ç¤¼æ–‡å³¶", prefecture: "åŒ—æµ·é“", description: "ã€ŒèŠ±ã®æµ®å³¶ã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã€300ç¨®é¡ä»¥ä¸Šã®é«˜å±±æ¤ç‰©ãŒå’²ãèª‡ã‚Šã¾ã™ã€‚", lat: 45.38, lon: 141.04, rarity: "R" },
        { name: "å³å³¶ (å®®å³¶)", prefecture: "åºƒå³¶çœŒ", description: "æµ·ã«æµ®ã‹ã¶å¤§é³¥å±…ã§æœ‰åãªå³å³¶ç¥ç¤¾ãŒã‚ã‚Šã¾ã™ã€‚æ—¥æœ¬ä¸‰æ™¯ã®ä¸€ã¤ã«æ•°ãˆã‚‰ã‚Œã‚‹æ™¯å‹åœ°ã§ã™ã€‚", lat: 34.29, lon: 132.32, rarity: "R" },
        { name: "ç›´å³¶", prefecture: "é¦™å·çœŒ", description: "ã‚¢ãƒ¼ãƒˆã®å³¶ã¨ã—ã¦ä¸–ç•Œçš„ã«æœ‰åã€‚è‰é–“å½Œç”Ÿã®ã€Œèµ¤ã‹ã¼ã¡ã‚ƒã€ãªã©ã€å±‹å¤–ã‚¢ãƒ¼ãƒˆãŒç‚¹åœ¨ã—ã¾ã™ã€‚", lat: 34.45, lon: 133.99, rarity: "R" },
        { name: "ç«¹å¯Œå³¶", prefecture: "æ²–ç¸„çœŒ", description: "èµ¤ã„ç“¦å±‹æ ¹ã®ä¼çµ±çš„ãªé›†è½ã¨ã€æ°´ç‰›è»Šã§ã®è¦³å…‰ãŒæœ‰åã€‚æ˜Ÿç ‚ã®æµœã‚‚äººæ°—ã‚¹ãƒãƒƒãƒˆã§ã™ã€‚", lat: 24.32, lon: 124.08, rarity: "R" },
        { name: "å°è±†å³¶", prefecture: "é¦™å·çœŒ", description: "ã‚ªãƒªãƒ¼ãƒ–ã®æ ½åŸ¹ãŒç››ã‚“ã§ã€ã€Œã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ­ãƒ¼ãƒ‰ã€ã¯æ‹äººãŸã¡ã®è–åœ°ã¨ã—ã¦äººæ°—ã§ã™ã€‚", lat: 34.48, lon: 134.25, rarity: "R" },
        { name: "ç¨®å­å³¶", prefecture: "é¹¿å…å³¶çœŒ", description: "é‰„ç ²ä¼æ¥ã®åœ°ã¨ã—ã¦æ­´å²ã«åã‚’åˆ»ã‚€ä¸€æ–¹ã€æ—¥æœ¬æœ€å¤§ã®ãƒ­ã‚±ãƒƒãƒˆç™ºå°„å ´ãŒã‚ã‚Šã¾ã™ã€‚", lat: 30.58, lon: 130.97, rarity: "R" },
        { name: "å¥„ç¾å¤§å³¶", prefecture: "é¹¿å…å³¶çœŒ", description: "ã‚¢ãƒãƒŸãƒã‚¯ãƒ­ã‚¦ã‚µã‚®ãªã©å¸Œå°‘ãªå›ºæœ‰ç¨®ãŒç”Ÿæ¯ã™ã‚‹è‡ªç„¶è±Šã‹ãªå³¶ã€‚ç‹¬ç‰¹ã®å³¶å”„ã‚„å¤§å³¶ç´¬ã‚‚æœ‰åã€‚", lat: 28.28, lon: 129.48, rarity: "R" },
        { name: "å®®å¤å³¶", prefecture: "æ²–ç¸„çœŒ", description: "ã€Œå®®å¤ãƒ–ãƒ«ãƒ¼ã€ã¨ç§°ã•ã‚Œã‚‹é€æ˜åº¦ã®é«˜ã„æµ·ãŒé­…åŠ›ã€‚ä¼Šè‰¯éƒ¨å¤§æ©‹ãªã©çµ¶æ™¯ã®ãƒ‰ãƒ©ã‚¤ãƒ–ã‚³ãƒ¼ã‚¹ã‚‚äººæ°—ã€‚", lat: 24.76, lon: 125.33, rarity: "R" },
        { name: "çŸ³å£å³¶", prefecture: "æ²–ç¸„çœŒ", description: "å…«é‡å±±è«¸å³¶ã®ç„é–¢å£ã€‚å·å¹³æ¹¾ã®ç¾ã—ã„æ™¯è‰²ã‚„ã€ãƒãƒ³ã‚°ãƒ­ãƒ¼ãƒ–ã®æ£®ãªã©è±Šã‹ãªè‡ªç„¶ãŒåºƒãŒã‚Šã¾ã™ã€‚", lat: 24.34, lon: 124.15, rarity: "R" },
        { name: "çŒ¿å³¶", prefecture: "ç¥å¥ˆå·çœŒ", description: "æ±äº¬æ¹¾ã«æµ®ã‹ã¶å”¯ä¸€ã®è‡ªç„¶å³¶ã€‚æ—§æ—¥æœ¬è»ã®è¦å¡è·¡ãŒæ®‹ã‚Šã€ãƒ©ãƒ”ãƒ¥ã‚¿ã®ã‚ˆã†ãªä¸–ç•ŒãŒåºƒãŒã‚Šã¾ã™ã€‚", lat: 35.29, lon: 139.66, rarity: "R" },
        { name: "æ±Ÿã®å³¶", prefecture: "ç¥å¥ˆå·çœŒ", description: "æ¹˜å—ã‚’ä»£è¡¨ã™ã‚‹è¦³å…‰åœ°ã€‚æ±Ÿå³¶ç¥ç¤¾ã‚„ã‚·ãƒ¼ã‚­ãƒ£ãƒ³ãƒ‰ãƒ«ãªã©è¦‹ã©ã“ã‚å¤šæ•°ã€‚", lat: 35.3, lon: 139.48, rarity: "R" },
        { name: "è§’å³¶", prefecture: "å±±å£çœŒ", description: "ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚°ãƒªãƒ¼ãƒ³ã®æµ·ã«æ¶ã‹ã‚‹è§’å³¶å¤§æ©‹ã®çµ¶æ™¯ã§æœ‰åã€‚å¤šãã®æ˜ ç”»ã‚„CMã®ãƒ­ã‚±åœ°ã«ãªã£ã¦ã„ã¾ã™ã€‚", lat: 34.35, lon: 130.84, rarity: "R" },
        { name: "æŸå³¶", prefecture: "é«˜çŸ¥çœŒ", description: "èˆ¹ãŒå®™ã«æµ®ã„ã¦è¦‹ãˆã‚‹ã»ã©é€æ˜åº¦ã®é«˜ã„æµ·ãŒé­…åŠ›ã€‚æ—¥æœ¬æœ‰æ•°ã®ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ã‚¹ãƒãƒƒãƒˆã§ã™ã€‚", lat: 32.76, lon: 132.63, rarity: "R" },
        { name: "ç”°ä»£å³¶", prefecture: "å®®åŸçœŒ", description: "ã€ŒçŒ«ã®å³¶ã€ã¨ã—ã¦æœ‰åã§ã€å¤šãã®çŒ«ãŒè‡ªç”±ã«æš®ã‚‰ã—ã¦ã„ã¾ã™ã€‚çŒ«ç¥ç¤¾ã‚‚ã‚ã‚Šã¾ã™ã€‚", lat: 38.29, lon: 141.41, rarity: "R" },
        { name: "é’å³¶", prefecture: "æ„›åª›çœŒ", description: "ä½æ°‘ã®æ•°ã‚ˆã‚ŠçŒ«ã®æ•°ãŒã¯ã‚‹ã‹ã«å¤šã„ã€ŒçŒ«ã®æ¥½åœ’ã€ã¨ã—ã¦ä¸–ç•Œçš„ã«æœ‰åã«ãªã‚Šã¾ã—ãŸã€‚", lat: 33.82, lon: 132.46, rarity: "R" },
        // N (ä¸Šè¨˜ä»¥å¤–ã™ã¹ã¦)
        { name: "å¥¥å°»å³¶", prefecture: "åŒ—æµ·é“", description: "1993å¹´ã®åŒ—æµ·é“å—è¥¿æ²–åœ°éœ‡ã‹ã‚‰ã®å¾©èˆˆã‚’é‚ã’ãŸå³¶ã€‚ã‚¦ãƒ‹ã®å‘³ãŒè‰¯ã„ã“ã¨ã§æœ‰åã€‚", lat: 42.16, lon: 139.46, rarity: "N" },
        { name: "è•ªå³¶", prefecture: "é’æ£®çœŒ", description: "ã‚¦ãƒŸãƒã‚³ã®ç¹æ®–åœ°ã¨ã—ã¦å›½ã®å¤©ç„¶è¨˜å¿µç‰©ã«æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚é™¸ç¶šãã®å³¶ã§ã™ã€‚", lat: 40.52, lon: 141.56, rarity: "N" },
        { name: "é‡‘è¯å±±", prefecture: "å®®åŸçœŒ", description: "å³¶å…¨ä½“ãŒé»„é‡‘å±±ç¥ç¤¾ã®ç¥åŸŸã¨ã•ã‚Œã€é¹¿ãŒç”Ÿæ¯ã€‚ã€Œ3å¹´ç¶šã‘ã¦ãŠå‚ã‚Šã™ã‚Œã°ãŠé‡‘ã«å›°ã‚‰ãªã„ã€ã¨ã„ã†è¨€ã„ä¼ãˆã‚‚ã€‚", lat: 38.29, lon: 141.56, rarity: "N" },
        { name: "é£›å³¶", prefecture: "å±±å½¢çœŒ", description: "æ¸¡ã‚Šé³¥ã®ä¸­ç¶™åœ°ã¨ã—ã¦ãƒãƒ¼ãƒ‰ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°ãŒç››ã‚“ã€‚å±±å½¢çœŒå”¯ä¸€ã®æœ‰äººé›¢å³¶ã§ã™ã€‚", lat: 39.2, lon: 139.56, rarity: "N" },
        { name: "æ²–ãƒå³¶", prefecture: "åƒè‘‰çœŒ", description: "å—æˆ¿ç·ã«ä½ç½®ã—ã€ç ‚å·ã§é™¸ç¶šãã«ãªã£ã¦ã„ã‚‹å³¶ã€‚å¤šæ§˜ãªæµ·å²¸ç”Ÿç‰©ãŒè¦³å¯Ÿã§ãã¾ã™ã€‚", lat: 34.97, lon: 139.85, rarity: "N" },
        { name: "å…«ä¸ˆå³¶", prefecture: "æ±äº¬éƒ½", description: "ã€Œå…«ä¸ˆå¯Œå£«ã€ã¨ã€Œä¸‰åŸå±±ã€ã®2ã¤ã®ç«å±±ã‹ã‚‰ãªã‚‹å³¶ã€‚æ¸©æ³‰ã‚„å³¶å¯¿å¸ãŒæ¥½ã—ã‚ã¾ã™ã€‚", lat: 33.1, lon: 139.79, rarity: "N" },
        { name: "ç²Ÿå³¶", prefecture: "æ–°æ½ŸçœŒ", description: "ã€Œç²Ÿå³¶æµ¦æ‘ã€ã¨ã—ã¦ä¸€ã¤ã®æ‘ã‚’ãªã™å³¶ã€‚é¦¬ãŒã®ã‚“ã³ã‚Šã¨è‰ã‚’é£Ÿã‚€ç‰§æ­Œçš„ãªé¢¨æ™¯ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚", lat: 38.45, lon: 139.24, rarity: "N" },
        { name: "èƒ½ç™»å³¶", prefecture: "çŸ³å·çœŒ", description: "èƒ½ç™»åŠå³¶ã¨2ã¤ã®æ©‹ã§çµã°ã‚ŒãŸå³¶ã€‚æ°´æ—é¤¨ã‚„ã‚¬ãƒ©ã‚¹ç¾è¡“é¤¨ãªã©ãŒã‚ã‚Šã¾ã™ã€‚", lat: 37.1, lon: 136.98, rarity: "N" },
        { name: "æ°´å³¶", prefecture: "ç¦äº•çœŒ", description: "æ•¦è³€æ¹¾ã«æµ®ã‹ã¶ç„¡äººå³¶ã€‚é€æ˜åº¦ã®é«˜ã„æµ·ã¨ç™½ã„ç ‚æµœã‹ã‚‰ã€ŒåŒ—é™¸ã®ãƒãƒ¯ã‚¤ã€ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚", lat: 35.73, lon: 136.0, rarity: "N" },
        { name: "åˆå³¶", prefecture: "é™å²¡çœŒ", description: "é¦–éƒ½åœã‹ã‚‰æœ€ã‚‚è¿‘ã„é›¢å³¶ã€‚ãƒªã‚¾ãƒ¼ãƒˆæ–½è¨­ãŒå……å®Ÿã—ã¦ãŠã‚Šã€æ‰‹è»½ã«å³¶æ™‚é–“ã‚’æ¥½ã—ã‚ã¾ã™ã€‚", lat: 35.03, lon: 139.17, rarity: "N" },
        { name: "æ—¥é–“è³€å³¶", prefecture: "æ„›çŸ¥çœŒ", description: "ã€Œã‚¿ã‚³ã¨ãƒ•ã‚°ã®å³¶ã€ã¨ã—ã¦æœ‰åã€‚å³¶ã®è¥¿æ¸¯ã¨æ±æ¸¯ã«ã¯å·¨å¤§ãªã‚¿ã‚³ã®ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚", lat: 34.7, lon: 136.98, rarity: "N" },
        { name: "ä½ä¹…å³¶", prefecture: "æ„›çŸ¥çœŒ", description: "ã‚¢ãƒ¼ãƒˆã®å³¶ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã€å³¶ã®ã‚ã¡ã“ã¡ã«ã‚¢ãƒ¼ãƒˆä½œå“ãŒå±•ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚", lat: 34.72, lon: 137.04, rarity: "N" },
        { name: "ç­”å¿—å³¶", prefecture: "ä¸‰é‡çœŒ", description: "é³¥ç¾½æ¸¯ã®æ²–åˆã«æµ®ã‹ã¶ã€ä¼Šå‹¢æ¹¾ã§æœ€å¤§ã®å³¶ã€‚æ–°é®®ãªæµ·ã®å¹¸ã¨ã€ç‹¬ç‰¹ã®å¯å±‹å­åˆ¶åº¦ã§çŸ¥ã‚‰ã‚Œã¾ã™ã€‚", lat: 34.52, lon: 136.86, rarity: "N" },
        { name: "è³¢å³¶", prefecture: "ä¸‰é‡çœŒ", description: "è‹±è™æ¹¾ã«æµ®ã‹ã¶ã€ä¼Šå‹¢å¿—æ‘©è¦³å…‰ã®æ‹ ç‚¹ã€‚2016å¹´ã«ã¯G7ä¼Šå‹¢å¿—æ‘©ã‚µãƒŸãƒƒãƒˆãŒé–‹å‚¬ã•ã‚Œã¾ã—ãŸã€‚", lat: 34.31, lon: 136.82, rarity: "N" },
        { name: "æ²–å³¶", prefecture: "æ»‹è³€çœŒ", description: "çµç¶æ¹–ã«æµ®ã‹ã¶æ—¥æœ¬ã§å”¯ä¸€ã®æ·¡æ°´æ¹–ã«ã‚ã‚‹æœ‰äººå³¶ã€‚å³¶æ°‘ã®ä¸»ãªäº¤é€šæ‰‹æ®µã¯è‡ªè»¢è»Šã§ã™ã€‚", lat: 35.21, lon: 136.05, rarity: "N" },
        { name: "æ·¡è·¯å³¶", prefecture: "å…µåº«çœŒ", description: "å›½ç”Ÿã¿ç¥è©±ã‚†ã‹ã‚Šã®å³¶ã€‚ç‰ã­ãã®ç”Ÿç”£ãŒç››ã‚“ã§ã€æ˜çŸ³æµ·å³¡å¤§æ©‹ã§æœ¬å·ã¨çµã°ã‚Œã¦ã„ã¾ã™ã€‚", lat: 34.45, lon: 134.8, rarity: "N" },
        { name: "å¤§ä¸‰å³¶", prefecture: "æ„›åª›çœŒ", description: "ã€Œç¥ã®å³¶ã€ã¨å‘¼ã°ã‚Œã€å›½å®ã®ç”²å†‘ã®ç´„8å‰²ã‚’æ‰€è”µã™ã‚‹å¤§å±±ç¥‡ç¥ç¤¾ãŒã‚ã‚Šã¾ã™ã€‚ã—ã¾ãªã¿æµ·é“ã®å³¶ã®ã²ã¨ã¤ã€‚", lat: 34.24, lon: 133.0, rarity: "N" },
        { name: "é«˜å³¶", prefecture: "ä½è³€çœŒ", description: "å”æ´¥å¸‚ã®æ²–ã«æµ®ã‹ã¶å³¶ã€‚ã€Œå®å½“ç¥ç¤¾ã€ãŒã‚ã‚Šã€å®ãã˜å½“é¸ã®ã”åˆ©ç›ŠãŒã‚ã‚‹ã¨ã—ã¦å¤šãã®å‚æ‹è€…ãŒè¨ªã‚Œã¾ã™ã€‚", lat: 33.49, lon: 129.97, rarity: "N" },
        { name: "å¯¾é¦¬", prefecture: "é•·å´çœŒ", description: "éŸ“å›½ã¾ã§ç´„50kmã®å›½å¢ƒã®å³¶ã€‚ç‹¬è‡ªã®ç”Ÿæ…‹ç³»ã¨ã€å¤ä»£ã‹ã‚‰ã®æ­´å²çš„ãªäº¤æµã®è·¡ãŒæ®‹ã£ã¦ã„ã¾ã™ã€‚", lat: 34.25, lon: 129.28, rarity: "N" },
        { name: "å£±å²å³¶", prefecture: "é•·å´çœŒ", description: "ã€Œé­å¿—å€­äººä¼ã€ã«ã‚‚ç™»å ´ã™ã‚‹æ­´å²ã‚ã‚‹å³¶ã€‚éº¦ç„¼é…ç™ºç¥¥ã®åœ°ã¨ã‚‚è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚", lat: 33.78, lon: 129.72, rarity: "N" },
        { name: "ç¦æ±Ÿå³¶", prefecture: "é•·å´çœŒ", description: "äº”å³¶åˆ—å³¶ã®å—è¥¿ç«¯ã«ä½ç½®ã™ã‚‹æœ€å¤§ã®å³¶ã€‚ç¾ã—ã„æ•™ä¼šç¾¤ã‚„ã€é€ãé€šã£ãŸé«˜æµœæµ·æ°´æµ´å ´ãŒæœ‰åã€‚", lat: 32.68, lon: 128.84, rarity: "N" },
        { name: "å¤©è‰ä¸‹å³¶", prefecture: "ç†Šæœ¬çœŒ", description: "å¤©è‰è«¸å³¶ã§æœ€å¤§ã®å³¶ã€‚ã‚­ãƒªã‚·ã‚¿ãƒ³ã®æ­´å²ãŒè‰²æ¿ƒãæ®‹ã‚Šã€ã‚¤ãƒ«ã‚«ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°ã‚‚æ¥½ã—ã‚ã¾ã™ã€‚", lat: 32.37, lon: 130.1, rarity: "N" },
        { name: "å§«å³¶", prefecture: "å¤§åˆ†çœŒ", description: "é»’æ›œçŸ³ã®ç”£åœ°ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã€ç‹¬ç‰¹ã®ç›†è¸Šã‚Šã€Œå§«å³¶ç›†è¸Šã‚Šã€ãŒæœ‰åã§ã™ã€‚", lat: 33.72, lon: 131.68, rarity: "N" },
        { name: "é’å³¶", prefecture: "å®®å´çœŒ", description: "ã€Œé¬¼ã®æ´—æ¿¯æ¿ã€ã¨å‘¼ã°ã‚Œã‚‹å¥‡å²©ã«å›²ã¾ã‚ŒãŸå³¶ã€‚äºœç†±å¸¯æ¤ç‰©ãŒèŒ‚ã‚‹å³¶å†…ã«ã¯é’å³¶ç¥ç¤¾ãŒã‚ã‚Šã¾ã™ã€‚", lat: 31.8, lon: 131.47, rarity: "N" },
        { name: "ä¸è«–å³¶", prefecture: "é¹¿å…å³¶çœŒ", description: "ã€Œæ±æ´‹ã®çœŸç ã€ã¨ç§°ã•ã‚Œã‚‹ç¾ã—ã„å³¶ã€‚å¹²æ½®æ™‚ã«ã ã‘ç¾ã‚Œã‚‹ç ‚æµœã€Œç™¾åˆãƒ¶æµœã€ã¯çµ¶æ™¯ã§ã™ã€‚", lat: 27.03, lon: 128.42, rarity: "N" },
        { name: "æ²–ç¸„æœ¬å³¶", prefecture: "æ²–ç¸„çœŒ", description: "æ²–ç¸„çœŒã®ä¸­å¿ƒã§ã€é‚£è¦‡å¸‚ã‚„ç¾ã—ã„ãƒ“ãƒ¼ãƒã€ä¸–ç•Œéºç”£ã®é¦–é‡ŒåŸè·¡ãªã©è¦‹ã©ã“ã‚ãŒæº€è¼‰ã€‚", lat: 26.33, lon: 127.8, rarity: "N" },
      ];

      // DOM Elements
      const gachaButton = document.getElementById("gacha-button");
      const resultCard = document.getElementById("result-card");
      const initialState = document.getElementById("initial-state");
      const resultState = document.getElementById("result-state");
      const rarityDisplay = document.getElementById("rarity-display");
      const islandName = document.getElementById("island-name");
      const islandPrefecture = document.getElementById("island-prefecture");
      const islandDescription = document.getElementById("island-description");
      const mapLink = document.getElementById("map-link");
      const newBadge = document.getElementById("new-badge");

      // Collection Elements
      const collectionGrid = document.getElementById("collection-grid");
      const collectionCount = document.getElementById("collection-count");
      const totalCount = document.getElementById("total-count");
      const resetCollectionButton = document.getElementById("reset-collection-button");

      // Modal Elements
      const confirmModal = document.getElementById("confirm-modal");
      const confirmResetButton = document.getElementById("confirm-reset-button");
      const cancelResetButton = document.getElementById("cancel-reset-button");

      let collectedIslands = [];
      const STORAGE_KEY = "islandGachaCollection";

      // --- Gacha Logic ---
      function drawGacha() {
        const rarityTable = { SSR: 0.05, SR: 0.1, R: 0.2, N: 0.65 };
        const rand = Math.random();
        let cumulativeProb = 0;
        let selectedRarity = "N";

        for (const rarity in rarityTable) {
          cumulativeProb += rarityTable[rarity];
          if (rand < cumulativeProb) {
            selectedRarity = rarity;
            break;
          }
        }

        const islandsOfRarity = islands.filter((i) => i.rarity === selectedRarity);
        const randomIndex = Math.floor(Math.random() * islandsOfRarity.length);
        return islandsOfRarity[randomIndex];
      }

      // --- Collection Functions ---
      function loadCollection() {
        const data = localStorage.getItem(STORAGE_KEY);
        collectedIslands = data ? JSON.parse(data) : [];
      }

      function saveCollection() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(collectedIslands));
      }

      function renderCollection() {
        collectionGrid.innerHTML = "";
        const rarityOrder = { SSR: 0, SR: 1, R: 2, N: 3 };
        const sortedCollection = [...collectedIslands].sort((a, b) => {
          const rarityDiff = rarityOrder[a.rarity] - rarityOrder[b.rarity];
          if (rarityDiff !== 0) return rarityDiff;
          return islands.findIndex((i) => i.name === a.name) - islands.findIndex((i) => i.name === b.name);
        });

        sortedCollection.forEach((island) => {
          const islandEl = document.createElement("div");
          islandEl.textContent = island.name;
          const rarityClass = `rarity-${island.rarity.toLowerCase()}-bg`;
          islandEl.className = `p-2 rounded-lg text-sm font-semibold truncate text-gray-700 ${rarityClass}`;
          islandEl.title = `${island.rarity} - ${island.name}`;
          collectionGrid.appendChild(islandEl);
        });

        collectionCount.textContent = collectedIslands.length;
      }

      // --- UI Update ---
      function updateResultCard(island) {
        initialState.classList.add("hidden");
        resultState.classList.remove("hidden", "card-reveal");

        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
        resultCard.className = `backdrop-blur-sm rounded-2xl shadow-2xl p-6 min-h-[300px] flex flex-col justify-center items-center transition-all duration-300 relative rarity-${island.rarity.toLowerCase()}-bg`;
        rarityDisplay.textContent = island.rarity;
        rarityDisplay.className = `font-bold text-2xl mb-2 rarity-${island.rarity.toLowerCase()}-text`;

        islandName.textContent = island.name;
        islandPrefecture.textContent = island.prefecture;
        islandDescription.textContent = island.description;
        mapLink.href = `https://www.google.com/maps?q=${island.lat},${island.lon}&z=11`;

        requestAnimationFrame(() => {
          resultState.classList.add("card-reveal");
        });
      }

      // --- Event Listeners ---
      gachaButton.addEventListener("click", () => {
        const selectedIsland = drawGacha();
        const isNew = !collectedIslands.some((item) => item.name === selectedIsland.name);

        if (isNew) {
          collectedIslands.push(selectedIsland);
          saveCollection();
          renderCollection();
          newBadge.classList.remove("hidden");
        } else {
          newBadge.classList.add("hidden");
        }

        updateResultCard(selectedIsland);
      });

      resetCollectionButton.addEventListener("click", () => {
        confirmModal.classList.remove("hidden");
      });

      cancelResetButton.addEventListener("click", () => {
        confirmModal.classList.add("hidden");
      });

      confirmModal.addEventListener("click", (e) => {
        if (e.target === confirmModal) {
          confirmModal.classList.add("hidden");
        }
      });

      confirmResetButton.addEventListener("click", () => {
        collectedIslands = [];
        saveCollection();
        renderCollection();
        confirmModal.classList.add("hidden");
      });

      // --- Initialization ---
      function init() {
        totalCount.textContent = islands.length;
        loadCollection();
        renderCollection();
      }

      init();
    </script>
  </body>
</html>
